#!/usr/bin/env sh

set -e
VERSION=$1
NOTES=$2

# We first create a new text file which we will be releasing
echo "Create file to package... "
cd bin
mkdir -p tmp/bin
mkdir -p tmp/etc
mkdir -p tmp/lib
mkdir -p tmp/docs
cp ../build/awsmock/awsmock tmp/bin
cp ../build/core/libawsmockcore.so ../build/db/libawsmockdb.so ../build/service/libawsmocksrv.so ../build/worker/libawsmockwrk.so ./tmp/lib
cp ../etc/aws-mock.properties ./tmp/etc
cp ../README.md ./tmp
echo $VERSION >> ./tmp/VERSION

# Just creating a folder to dump our release in.
echo "Create tmp releases dir... "
mkdir -p releases

# Here we create a new release folder to put our hello.txt file in
# and we zip it up with the zip name using the VERSION in it.
echo "Create a folder to hold our new release demo.$VERSION.zip... "
zip -r "releases/aws-mock.$VERSION.zip" tmp/*

# finally we clean up any assets we don't need. We don't strickly
# need to do this and could just rely on our .gitIgnore file
# ignoring any assets we don't care about.
echo "cleanup any assets we no longer need ... "
rm -rf tmp
